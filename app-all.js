var hostName=window.location.host;var achievementsData={};var categories={};var categoriesArray=[];var pointsArray=[];var gridData=[];var regionStore=Ext.create("Ext.data.Store",{fields:["region","name"],data:[{region:"us.battle.net",name:"US"},{region:"eu.battle.net",name:"Europe"},{region:"kr.battle.net",name:"Korea"},{region:"tw.battle.net",name:"Taiwan"},{region:"www.battlenet.com.cn",name:"China"},{region:"sea.battle.net",name:"South East Asia"}]});var localeStore=Ext.create("Ext.data.Store",{fields:["locale","name"]});var pointsStore=Ext.create("Ext.data.Store",{fields:["points"],data:[{points:0},{points:10},{points:15},{points:20}]});var categoriesStore=Ext.create("Ext.data.Store",{fields:["categoryId","title"],autoLoad:true});var achievementsModel=Ext.define("AchievementsModel",{extend:"Ext.data.Model",fields:[{name:"title",type:"string"},{name:"description",type:"string"},{name:"achievementId",type:"int"},{name:"categoryTitle",type:"string"},{name:"points",type:"int"},{name:"icon",type:"auto"}]});var achievementsStore=Ext.create("Ext.data.Store",{model:"AchievementsModel",proxy:{type:"memory",reader:{type:"json"}}});function filterAchievements(){var b=Ext.getCmp("categoriesCombo");var d=Ext.getCmp("pointsCombo");var c=Ext.getCmp("keywordTextTitle");var a=Ext.getCmp("keywordTextDescription");achievementsStore.clearFilter(true);if(b.disabled==false&&b.getValue()!=null){achievementsStore.filter("categoryTitle",categories[b.getValue()])}if(d.disabled==false&&d.getValue()!=null){achievementsStore.filter("points",d.getValue())}if(c.disabled==false&&c.getValue()!=null&&c.getValue()!=""){achievementsStore.filter([{filterFn:function(e){if(e.get("title").indexOf(c.getValue())!=-1){return e}}}])}if(a.disabled==false&&a.getValue()!=null&&a.getValue()!=""){achievementsStore.filter([{filterFn:function(e){if(e.get("description").indexOf(a.getValue())!=-1){return e}}}])}if(!achievementsStore.isFiltered()){achievementsStore.loadData(gridData)}Ext.getCmp("numOfEntries").setText("Number of entries: "+achievementsStore.count())}var sc2achApp=Ext.application({name:"SC2 Achievements",appFolder:"app",launch:function(){Ext.create("Ext.container.Viewport",{layout:"column",items:[{xtype:"panel",layout:"vbox",width:280,height:600,items:[{xtype:"form",id:"filterForm",title:"Load Achievements",bodyPadding:10,margin:"0 0 20 0",width:280,defaultType:"combobox",flex:1,buttons:[{text:"Load",formBind:true,disabled:true,handler:function(){var a=this.up("form").getForm();if(a.isValid()){a.submit({waitMsg:"Loading...",method:"GET",url:"http://"+hostName+"/sc2ach/achievements.php",params:{region:"us.battle.net",locale:"en_US"},success:function(b,c){achievementsData={};categories={};gridData=[];categoriesArray=[];achievementsData=c.result.data;Ext.each(achievementsData.categories,function(d,e){if(d.hasOwnProperty("children")){Ext.each(d.children,function(g,f){categories[g.categoryId]=g.title;categoriesArray.push({categoryId:g.categoryId,title:g.title})})}else{categories[d.categoryId]=d.title;categoriesArray.push({categoryId:d.categoryId,title:d.title})}});categoriesStore.loadData(categoriesArray);Ext.each(achievementsData.achievements,function(d,e){var f={};f.title=d.title;f.description=d.description;f.achievementId=d.achievementId;f.categoryTitle=categories[d.categoryId];f.points=d.points;f.icon=d.icon;gridData[e]=f});achievementsStore.clearFilter(true);achievementsStore.loadData(gridData);Ext.getCmp("numOfEntries").setText("Number of entries: "+achievementsStore.count())},failure:function(b,c){if(c.failureType==Ext.form.Action.CLIENT_INVALID){Ext.Msg.alert("Failure","Client invalid")}else{if(c.failureType==Ext.form.Action.CONNECT_FAILURE){Ext.Msg.alert("Failure","Connect failure")}else{if(c.failureType==Ext.form.Action.SERVER_INVALID){Ext.Msg.alert("Failure","Server invalid")}else{Ext.Msg.alert("Failure",c.result.msg)}}}}})}}}],items:[{forceSelection:true,editable:false,allowBlank:false,fieldLabel:"Region",name:"region",store:regionStore,queryMode:"local",displayField:"name",valueField:"region",listeners:{afterrender:function(a){a.setValue(a.store.getAt(0).get("region"))},select:function(a){switch(a.value){case"us.battle.net":localeStore.loadData([{locale:"en_US",name:"US"},{locale:"es_MX",name:"Mexico"},{locale:"pt_BR",name:"Brazil"}]);break;case"eu.battle.net":localeStore.loadData([{locale:"en_GB",name:"Great Britain"},{locale:"es_ES",name:"Spain"},{locale:"fr_FR",name:"France"},{locale:"ru_RU",name:"Russia"},{locale:"de_DE",name:"Germany"},{locale:"pt_PT",name:"Portugal"},{locale:"pl_PL",name:"Poland"},{locale:"it_IT",name:"Italy"}]);break;case"kr.battle.net":localeStore.loadData([{locale:"ko_KR",name:"Korea"}]);break;case"tw.battle.net":localeStore.loadData([{locale:"zh_TW",name:"Taiwan"}]);break;case"www.battlenet.com.cn":localeStore.loadData([{locale:"zh_CN",name:"China"}]);break;case"sea.battle.net":localeStore.loadData([{locale:"en_US",name:"US"}]);break;default:localeStore.loadData([{locale:"en_US",name:"US"},{locale:"es_MX",name:"Mexico"},{locale:"pt_BR",name:"Brazil"}]);break}Ext.getCmp("localeCombo").setValue(localeStore.getAt(0).get("locale"))}}},{forceSelection:true,editable:false,allowBlank:false,fieldLabel:"Language/Locale:",name:"locale",store:localeStore,queryMode:"local",displayField:"name",valueField:"locale",id:"localeCombo",listeners:{afterrender:function(a){localeStore.loadData([{locale:"en_US",name:"US"},{locale:"es_MX",name:"Mexico"},{locale:"pt_BR",name:"Brazil"}]);a.setValue(a.store.getAt(0).get("locale"))}}}]},{xtype:"panel",flex:2,title:"Filter Achievements",bodyPadding:10,width:280,buttons:[{text:"Filter/Show All",disabled:true,id:"filterButton",handler:filterAchievements}],items:[{xtype:"combobox",forceSelection:true,editable:false,allowBlank:false,disabled:true,fieldLabel:"Category:",name:"title",store:categoriesStore,queryMode:"local",displayField:"title",valueField:"categoryId",id:"categoriesCombo",listeners:{select:filterAchievements}},{xtype:"combobox",forceSelection:true,editable:false,allowBlank:false,disabled:true,fieldLabel:"Points:",name:"points",store:pointsStore,queryMode:"local",displayField:"points",valueField:"points",id:"pointsCombo",listeners:{select:filterAchievements}},{xtype:"textfield",allowBlank:false,disabled:true,fieldLabel:"Keyword - Title:",name:"keywordT",id:"keywordTextTitle",listeners:{change:filterAchievements}},{xtype:"textfield",allowBlank:false,disabled:true,fieldLabel:"Keyword - Description:",name:"keywordD",id:"keywordTextDescription",listeners:{change:filterAchievements}},{xtype:"checkboxgroup",fieldLabel:"Filter by",layout:{type:"vbox",align:"left"},flex:1,columns:3,vertical:true,items:[{boxLabel:"Category",name:"filterRb",inputValue:"1",listeners:{change:function(e,f,c,d){var b=Ext.getCmp("categoriesCombo");var a=b.disabled;b.setDisabled((a?false:true));Ext.getCmp("filterButton").setDisabled(false)}}},{boxLabel:"Points",name:"filterRb",inputValue:"2",listeners:{change:function(e,f,c,d){var b=Ext.getCmp("pointsCombo");var a=b.disabled;b.setDisabled((a?false:true));Ext.getCmp("filterButton").setDisabled(false)}}},{boxLabel:"Keyword - Title",name:"filterRb",inputValue:"3",listeners:{change:function(e,f,c,d){var b=Ext.getCmp("keywordTextTitle");var a=b.disabled;b.setDisabled((a?false:true));Ext.getCmp("filterButton").setDisabled(false)}}},{boxLabel:"Keyword - Description",name:"filterRb",inputValue:"4",listeners:{change:function(e,f,c,d){var b=Ext.getCmp("keywordTextDescription");var a=b.disabled;b.setDisabled((a?false:true));Ext.getCmp("filterButton").setDisabled(false)}}}]}]},{xtype:"panel",flex:1,width:280,bodyPadding:10,layout:"column",items:[{xtype:"label",text:"Number of entries: 0",id:"numOfEntries",margin:"0 0 40 0"},{xtype:"label",html:"All information and resources/images belong to Blizzard &copy; Entertainment",margin:"0 0 10 0",id:"copyright"},{xtype:"label",html:"Developed by Vladimir Z aka VladDTerran &copy; 2014",id:"development"}]}]},{xtype:"grid",title:"Achievements",store:achievementsStore,forceFit:true,id:"achievementsGrid",columns:[{text:"Title",dataIndex:"title",flex:2,align:"center"},{text:"Description",dataIndex:"description",flex:4,align:"center"},{text:"Achievement ID",dataIndex:"achievementId",flex:2,align:"center"},{text:"Category Title",dataIndex:"categoryTitle",flex:2,align:"center"},{text:"Points",dataIndex:"points",flex:1,align:"center"},{text:"Icon",dataIndex:"icon",flex:1,align:"center",renderer:function(e,b,a,f,d,c){return'<div style="background-image: url('+e.url+"); background-position: "+e.x+"px "+e.y+'px; width: 75px; height: 75px;"></div>'}}],width:1024,height:600}]});Ext.Msg.show({title:"Welcome",msg:"This is Starcraft2 Achievements application. Use it to preview all SC2 achievements. Filter them by category, points and keyword.",buttons:Ext.Msg.OK,fn:function(){Ext.Msg.show({title:"Welcome",msg:'Select region and locale and then press "Load" button to fetch all achievements. Use "Filter/Show All" button to filter or to reload the complete list.',buttons:Ext.Msg.OK,})}})}});